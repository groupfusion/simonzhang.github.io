<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>秦风 Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="随时记录，从现在开始吧…">
<meta property="og:type" content="website">
<meta property="og:title" content="秦风 Blog">
<meta property="og:url" content="http://petewell.cn/page/2/index.html">
<meta property="og:site_name" content="秦风 Blog">
<meta property="og:description" content="随时记录，从现在开始吧…">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="秦风 Blog">
<meta name="twitter:description" content="随时记录，从现在开始吧…">
  
    <link rel="alternate" href="/atom.xml" title="秦风 Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

  
<!-- baidu_tongji -->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?851f9e44c200dcb806e10fef50abc903";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<!-- End baidu_tongji -->


</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">秦风 Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">生活、学习，点点滴滴，从现在开始吧…</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/category">分类</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
          <a class="main-nav-link" href="/about">关于</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://petewell.cn"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-02.nginx_tomcat_redis" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/17/02.nginx_tomcat_redis/" class="article-date">
  <time datetime="2017-01-17T09:47:57.000Z" itemprop="datePublished">2017-01-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/17/02.nginx_tomcat_redis/">02.nginx+tomcat+redis实现集群环境的session共享。</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="02-nginx-tomcat-redis实现集群环境的session共享。"><a href="#02-nginx-tomcat-redis实现集群环境的session共享。" class="headerlink" title="02.nginx+tomcat+redis实现集群环境的session共享。"></a>02.nginx+tomcat+redis实现集群环境的session共享。</h2><p>注：tomcat-redis-session-manager 仅对tomcat8.0.39以下版支持。8.5.9这个版本不支持，缺少LifecycleSupport 相关类。</p>
<h3 id="nginx-tomcat-集群配置"><a href="#nginx-tomcat-集群配置" class="headerlink" title="nginx tomcat 集群配置"></a>nginx tomcat 集群配置</h3><p>参考：</p>
<p><a href="http://blog.csdn.net/zht666/article/details/38515147" target="_blank" rel="external">Nginx+Tomcat7+Mencached负载均衡集群部署笔记</a></p>
<p><a href="http://www.cnblogs.com/chihirotan/p/5791401.html" target="_blank" rel="external">Nginx-tomcat-redis——负载均衡以及session共享</a></p>
<p>nginx\tomcat 采用集群方式，部署在一台window机器上192.168.0.20。redis 部署在一台centos下，ip为192.168.0.21；</p>
<p>配置步骤如下：<br>1、安装nginx及单机测试，这里就不多说了，不会的同学可以百度下，很多。<br>2、安装tomcat 从官网下载tomcat7。注：在同一机器上部署需要修改端口，否则可能因端口冲突无法启动；我的端口分别设置为8080，8081，8082<br>3、nginx集群配置<br>修改nginx安装目录下的conf/nginx.conf 文件。修改部分如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">http&#123;</div><div class="line">   #设定负载均衡的服务器列表，可以设置多个upstream，但mysvr名字要区分</div><div class="line">   upstream myClusterServer1 &#123;</div><div class="line">      #weigth参数表示权值，权值越高被分配到的几率越大</div><div class="line">      #本机上的Squid开启3128端口</div><div class="line">      server 127.0.0.1:8080  weight=5;</div><div class="line">      server 127.0.0.1:8081  weight=5;</div><div class="line">      server 127.0.0.1:8082  weight=5;</div><div class="line">   &#125;</div><div class="line">   server &#123;</div><div class="line">       ...</div><div class="line">       location / &#123;</div><div class="line">           root   html;</div><div class="line">           index  index.html index.htm index.jsp;</div><div class="line">           #请求转向mysvr 定义的服务器列表</div><div class="line">           proxy_pass    http://myClusterServer1;</div><div class="line">           proxy_redirect default;</div><div class="line">           #跟代理服务器连接的超时时间，必须留意这个time out时间不能超过75秒，当一台服务器当掉时，过10秒转发到另外一台服务器。</div><div class="line">       	proxy_connect_timeout 10;</div><div class="line">       &#125;</div><div class="line">       ...</div><div class="line">   &#125;</div><div class="line">   ....</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>4、启动3个tomcat和nginx。<br>5、测试，编写一个简单jsp进行测试。放到tomcat下，然后<a href="http://localhost/test.jsp" target="_blank" rel="external">http://localhost/test.jsp</a>访问,<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line">&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;en&quot;&gt;</div><div class="line">&lt;head&gt;</div><div class="line">    &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=iso-8859-1&quot;/&gt;</div><div class="line">    &lt;meta http-equiv=&quot;pragma&quot; content=&quot;no-cache&quot;/&gt;&lt;!-- HTTP 1.0 --&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">   &lt;h1&gt;Session&lt;/h1&gt;</div><div class="line">   &lt;table style=&quot;text-align: left;&quot; border=&quot;0&quot;&gt;</div><div class="line">     &lt;tr&gt;</div><div class="line">       &lt;th&gt;Session Id&lt;/th&gt;</div><div class="line">       &lt;td&gt;&lt;%=request.getSession().hashCode()%&gt;&lt;/td&gt;</div><div class="line">     &lt;/tr&gt;</div><div class="line">     &lt;tr&gt;</div><div class="line">       &lt;th&gt;Session IP&lt;/th&gt;</div><div class="line">       &lt;td&gt;&lt;%=request.getServerName()%&gt;&lt;/td&gt;</div><div class="line">     &lt;/tr&gt;</div><div class="line">     &lt;tr&gt;</div><div class="line">       &lt;th&gt;Session port&lt;/th&gt;</div><div class="line">       &lt;td&gt;&lt;%=request.getServerPort()%&gt;&lt;/td&gt;</div><div class="line">     &lt;/tr&gt;</div><div class="line">     &lt;tr&gt;</div><div class="line">       &lt;th&gt;server&lt;/th&gt;</div><div class="line">       &lt;td&gt;this is Tomcat Server 8080&lt;/td&gt;</div><div class="line">     &lt;/tr&gt;</div><div class="line">   &lt;/table&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure></p>
<h3 id="redis实现session共享"><a href="#redis实现session共享" class="headerlink" title="redis实现session共享"></a>redis实现session共享</h3><p>参考：<a href="http://blog.csdn.net/chszs/article/details/42610365" target="_blank" rel="external">用Redis存储Tomcat集群的Session</a></p>
<p>redis安装这里就不多说了。参见我的<a href="">redis3.2.6_安装及分布配置</a></p>
<p>1、准备tomcat-redis-session-manager包</p>
<p>注：tomcat-redis-session-manager仅支持tomcat8.0.39以下版本，并按网上提供的方法修改时没有问题的。对8.5以上版本依然没用。</p>
<p>你要到<a href="https://github.com/jcoleman/tomcat-redis-session-manager" target="_blank" rel="external">tomcat-redis-session-manager</a>下载源码编译。</p>
<p>在配置gradle时会遇到“No such property: sonatypeUsername错误”</p>
<p>解决方法：<br>在项目根目录下创建gradle.properties文件，文件中添加如下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sonatypeUsername=</div><div class="line">sonatypePassword=</div><div class="line">sonatypeRepo=</div></pre></td></tr></table></figure>
<p>编译成功后将commons-pool2-2.4.2.jar、jedis-2.9.0.jar、tomcat-redis-session-manager-2.0.0.jar 放到tomcat的lib目录下。</p>
<p>2、在tomcat context.xml 文件中增加先内容。</p>
<p>单机redis缓存（master -slave模式）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;!--单点配置--&gt;</div><div class="line">&lt;Valve className=&quot;com.orangefunction.tomcat.redissessions.RedisSessionHandlerValve&quot; /&gt;</div><div class="line">&lt;Manager className=&quot;com.orangefunction.tomcat.redissessions.RedisSessionManager&quot;</div><div class="line">         host=&quot;192.168.100.194&quot;</div><div class="line">         port=&quot;6379&quot;</div><div class="line">         database=&quot;0&quot;</div><div class="line">         maxInactiveInterval=&quot;60&quot;</div><div class="line">         /&gt;</div></pre></td></tr></table></figure>
<p>Sentinel 配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"> &lt;!-- Sentinel 配置 --&gt;</div><div class="line"> &lt;Valve className=&quot;com.orangefunction.tomcat.redissessions.RedisSessionHandlerValve&quot; /&gt;</div><div class="line"> &lt;Manager className=&quot;com.orangefunction.tomcat.redissessions.RedisSessionManager&quot;</div><div class="line">   maxInactiveInterval=&quot;60&quot;</div><div class="line">sentinelMaster=&quot;mymaster&quot;</div><div class="line">   sentinels=&quot;192.168.0.194:26379,192.168.0.194:36379,192.168.0.194:46379&quot;/&gt;</div></pre></td></tr></table></figure>
<p>3、编写测试jsp。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;</div><div class="line">    pageEncoding=&quot;UTF-8&quot;%&gt;</div><div class="line">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;</div><div class="line">&lt;title&gt;Insert title here&lt;/title&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">    &lt;%=session.getId()%&gt;&lt;br&gt;</div><div class="line">    &lt;%</div><div class="line">        String msg = (String) session.getAttribute(&quot;msg&quot;);</div><div class="line">        if (null == msg) &#123;</div><div class="line">            session.setAttribute(&quot;msg&quot;, &quot;Hello!&quot;);</div><div class="line">        &#125; else &#123;</div><div class="line">            session.setAttribute(&quot;msg&quot;, msg + 0);</div><div class="line">        &#125;</div><div class="line">    %&gt;</div><div class="line">    &lt;%=session.getAttribute(&quot;msg&quot;)%&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure></p>
<p>分别部署到tomcat下</p>
<p>4、启动nginx和tomcat</p>
<p>分别启动tomcat和nginx后，然后访问<a href="http://localhost/test.jsp" target="_blank" rel="external">http://localhost/test.jsp</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">B1ACBA61EEB15371A3896FCEA5FAF69D</div><div class="line">Hello!0000</div></pre></td></tr></table></figure>
<p>若出现DENIED Redis is running in protected mode because protected mode is enabled问题<br>具体提示如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">redis.clients.jedis.exceptions.JedisDataException: DENIED Redis is running in protected mode because protected mode is enabled, no bind address was specified, no authentication password is requested to clients. In this mode connections are only accepted from the loopback interface. If you want to connect from external computers to Redis you may adopt one of the following solutions:</div><div class="line">1) Just disable protected mode sending the command &apos;CONFIG SET protected-mode no&apos; from the loopback interface by connecting to Redis from the same host the server is running, however MAKE SURE Redis is not publicly accessible from internet if you do so. Use CONFIG REWRITE to make this change permanent.</div><div class="line">2) Alternatively you can just disable the protected mode by editing the Redis configuration file, and setting the protected mode option to &apos;no&apos;, and then restarting the server.</div><div class="line">3) If you started the server manually just for testing, restart it with the &apos;--protected-mode no&apos; option.</div><div class="line">4) Setup a bind address or an authentication password. NOTE: You only need to do one of the above things in order for the server to start accepting connections from the outside.</div></pre></td></tr></table></figure></p>
<p>你可以根据你的实际情况做出处理。<br>我这里是临时测试，在启动时把protected-mode 设置为no<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># redis-server ./redis.conf --protected-mode no</div></pre></td></tr></table></figure></p>
<p>如果生产环境建议绑定一个地址或通过密码访问。</p>
<p>单机方式下上面的方式很容易解决。但集群方式存在一个很大的坑， one client（nginx+tomcat 集群） + one server（redis+sentinel集群）下。无论是关闭protected-mode 还是 bind address 和auth pass 都无效。</p>
<p>redis集群方式配置失败！！！！</p>
<p>参考：<br><a href="http://www.cnblogs.com/interdrp/p/4868740.html" target="_blank" rel="external">redis + Tomcat 8 的session共享解决</a></p>
<p>分布式集群Session共享 简单多tomcat8+redis的session共享实现<br><a href="http://blog.csdn.net/jerome_s/article/details/52658946" target="_blank" rel="external">http://blog.csdn.net/jerome_s/article/details/52658946</a><br><a href="http://blog.csdn.net/chszs/article/details/42610365" target="_blank" rel="external">用Redis存储Tomcat集群的Session</a><br><a href="http://www.cnblogs.com/LiZhiW/p/4851631.html#_label2" target="_blank" rel="external">02.Redis主从集群的Sentinel配置</a><br><a href="http://debugo.com/redis-sentinel/?utm_source=tuicool&amp;utm_medium=referral" target="_blank" rel="external">Redis Sentinel配置小记</a><br><a href="http://www.cnblogs.com/LiZhiW/p/4851640.html" target="_blank" rel="external">sentinel.conf配置详解</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://petewell.cn/2017/01/17/02.nginx_tomcat_redis/" data-id="cj49mjyb80003vts6te0263fq" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/分布式/">分布式</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-01.redis3.2.6_安装及分布式配置" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/17/01.redis3.2.6_安装及分布式配置/" class="article-date">
  <time datetime="2017-01-17T01:47:57.000Z" itemprop="datePublished">2017-01-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/17/01.redis3.2.6_安装及分布式配置/">01. Redis3.2.6 安装及分布式配置</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="01-Redis3-2-6-安装及分布式配置"><a href="#01-Redis3-2-6-安装及分布式配置" class="headerlink" title="01.Redis3.2.6 安装及分布式配置"></a>01.Redis3.2.6 安装及分布式配置</h2><p>参考<a href="http://blog.csdn.net/miyatang/article/details/47257209" target="_blank" rel="external">redis3.0.3 安装与配置</a></p>
<h3 id="1、安装"><a href="#1、安装" class="headerlink" title="1、安装"></a>1、安装</h3><p>####1.1 mac 上安装redis</p>
<p>1）官网 <a href="https://redis.io/" target="_blank" rel="external">https://redis.io/</a> 下载最新的稳定版本，我下的是3.2.6</p>
<p>2）sudo tar -zxf redis-3.2.6.zip 解压文件</p>
<p>3）进入解压后的目录 cd redis－3.2.6</p>
<p>4)、sudo make test 测试编译</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">  21 seconds - integration/convert-zipmap-hash-on-load</div><div class="line">  85 seconds - unit/dump</div><div class="line">  8 seconds - unit/limits</div><div class="line">  14 seconds - unit/introspection-2</div><div class="line">  78 seconds - integration/replication-2</div><div class="line">  93 seconds - unit/sort</div><div class="line">  14 seconds - unit/bitfield</div><div class="line">  100 seconds - unit/type/list-3</div><div class="line">  41 seconds - unit/maxmemory</div><div class="line">  43 seconds - unit/bitops</div><div class="line">  56 seconds - unit/scripting</div><div class="line">  128 seconds - unit/type/list-2</div><div class="line">  43 seconds - unit/memefficiency</div><div class="line">  135 seconds - integration/replication</div><div class="line">  79 seconds - unit/obuf-limits</div><div class="line">  148 seconds - integration/replication-3</div><div class="line">  75 seconds - unit/hyperloglog</div><div class="line">  162 seconds - integration/replication-4</div><div class="line">  104 seconds - unit/geo</div><div class="line">  182 seconds - integration/replication-psync</div><div class="line"></div><div class="line">\o/ All tests passed without errors!</div><div class="line"></div><div class="line">Cleanup: may take some time... OK</div></pre></td></tr></table></figure>
<p>5)、sudo make install</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">localhost:redis-3.2.6 xingzhe$ sudo make install</div><div class="line">Password:</div><div class="line">cd src &amp;&amp; /Applications/Xcode.app/Contents/Developer/usr/bin/make install</div><div class="line"></div><div class="line">Hint: It&apos;s a good idea to run &apos;make test&apos; ;)</div><div class="line"></div><div class="line">    INSTALL install</div><div class="line">    INSTALL install</div><div class="line">    INSTALL install</div><div class="line">    INSTALL install</div><div class="line">    INSTALL install</div></pre></td></tr></table></figure>
<p>至此，你已成功安装redis！</p>
<p>####1.2 centos7 上安装redis</p>
<p>1)、安装前，升级系统<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y update</div></pre></td></tr></table></figure></p>
<p>2)、官网下载<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget http://download.redis.io/releases/redis-3.2.6.tar.gz</div></pre></td></tr></table></figure></p>
<p>3)、解压<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tar -xvf redis-3.2.6.tar.gz redis-3.2.6</div></pre></td></tr></table></figure></p>
<p>4)、进入解压后的目录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cd redis-3.2.6</div></pre></td></tr></table></figure></p>
<p>5)、运行runtest<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># ./runtest</div><div class="line"> You need tcl 8.5 or newer in order to run the Redis test</div></pre></td></tr></table></figure></p>
<p>如果提示 需要安装tcl，执行6步，否则跳过。<br>6)、安装tcl<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># yum install tcl</div></pre></td></tr></table></figure></p>
<p>7)、编译<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"># make</div><div class="line">cd src &amp;&amp; make all</div><div class="line">make[1]: 进入目录“/tdata/redis-3.2.6/src”</div><div class="line">rm -rf redis-server redis-sentinel redis-cli redis-benchmark redis-check-rdb redis-check-aof *.o *.gcda *.gcno *.gcov redis.info lcov-html</div><div class="line">(cd ../deps &amp;&amp; make distclean)</div><div class="line">make[2]: 进入目录“/tdata/redis-3.2.6/deps”</div><div class="line">(cd hiredis &amp;&amp; make clean) &gt; /dev/null || true</div><div class="line">(cd linenoise &amp;&amp; make clean) &gt; /dev/null || true</div><div class="line">(cd lua &amp;&amp; make clean) &gt; /dev/null || true</div><div class="line">(cd geohash-int &amp;&amp; make clean) &gt; /dev/null || true</div><div class="line">(cd jemalloc &amp;&amp; [ -f Makefile ] &amp;&amp; make distclean) &gt; /dev/null || true</div><div class="line">(rm -f .make-*)</div><div class="line">make[2]: 离开目录“/tdata/redis-3.2.6/deps”</div><div class="line">(rm -f .make-*)</div><div class="line">echo STD=-std=c99 -pedantic -DREDIS_STATIC=&apos;&apos; &gt;&gt; .make-settings</div><div class="line">echo WARN=-Wall -W &gt;&gt; .make-settings</div><div class="line">echo OPT=-O2 &gt;&gt; .make-settings</div><div class="line">echo MALLOC=jemalloc &gt;&gt; .make-settings</div><div class="line">echo CFLAGS= &gt;&gt; .make-settings</div><div class="line">echo LDFLAGS= &gt;&gt; .make-settings</div><div class="line">echo REDIS_CFLAGS= &gt;&gt; .make-settings</div><div class="line">echo REDIS_LDFLAGS= &gt;&gt; .make-settings</div><div class="line">echo PREV_FINAL_CFLAGS=-std=c99 -pedantic -DREDIS_STATIC=&apos;&apos; -Wall -W -O2 -g -ggdb   -I../deps/geohash-int -I../deps/hiredis -I../deps/linenoise -I../deps/lua/src -DUSE_JEMALLOC -I../deps/jemalloc/include &gt;&gt; .make-settings</div><div class="line">echo PREV_FINAL_LDFLAGS=  -g -ggdb -rdynamic &gt;&gt; .make-settings</div><div class="line">(cd ../deps &amp;&amp; make hiredis linenoise lua geohash-int jemalloc)</div><div class="line">make[2]: 进入目录“/tdata/redis-3.2.6/deps”</div><div class="line">(cd hiredis &amp;&amp; make clean) &gt; /dev/null || true</div><div class="line">(cd linenoise &amp;&amp; make clean) &gt; /dev/null || true</div><div class="line">(cd lua &amp;&amp; make clean) &gt; /dev/null || true</div><div class="line">(cd geohash-int &amp;&amp; make clean) &gt; /dev/null || true</div><div class="line">(cd jemalloc &amp;&amp; [ -f Makefile ] &amp;&amp; make distclean) &gt; /dev/null || true</div><div class="line">(rm -f .make-*)</div><div class="line">(echo &quot;&quot; &gt; .make-cflags)</div><div class="line">(echo &quot;&quot; &gt; .make-ldflags)</div><div class="line">MAKE hiredis</div><div class="line">cd hiredis &amp;&amp; make static</div><div class="line">make[3]: 进入目录“/tdata/redis-3.2.6/deps/hiredis”</div><div class="line">gcc -std=c99 -pedantic -c -O3 -fPIC  -Wall -W -Wstrict-prototypes -Wwrite-strings -g -ggdb  net.c</div><div class="line">make[3]: gcc：命令未找到</div><div class="line">make[3]: *** [net.o] 错误 127</div><div class="line">make[3]: 离开目录“/tdata/redis-3.2.6/deps/hiredis”</div><div class="line">make[2]: *** [hiredis] 错误 2</div><div class="line">make[2]: 离开目录“/tdata/redis-3.2.6/deps”</div><div class="line">make[1]: [persist-settings] 错误 2 (忽略)</div><div class="line">    CC adlist.o</div><div class="line">/bin/sh: cc: 未找到命令</div><div class="line">make[1]: *** [adlist.o] 错误 127</div><div class="line">make[1]: 离开目录“/tdata/redis-3.2.6/src”</div><div class="line">make: *** [all] 错误 2</div></pre></td></tr></table></figure></p>
<p>若出现上面错误，说明缺少编译环境，需要安装gcc。否则跳过8步。<br>如果出现如下错误,请看第9步，否则跳过。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">cd src &amp;&amp; make all</div><div class="line">make[1]: 进入目录“/tdata/redis-3.2.6/src”</div><div class="line">    CC adlist.o</div><div class="line">In file included from adlist.c:34:0:</div><div class="line">zmalloc.h:50:31: 致命错误：jemalloc/jemalloc.h：没有那个文件或目录</div><div class="line"> #include &lt;jemalloc/jemalloc.h&gt;</div><div class="line">                               ^</div><div class="line">编译中断。</div><div class="line">make[1]: *** [adlist.o] 错误 1</div><div class="line">make[1]: 离开目录“/tdata/redis-3.2.6/src”</div><div class="line">make: *** [all] 错误 2</div></pre></td></tr></table></figure></p>
<p>8)、安装gcc<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># yum install gcc</div></pre></td></tr></table></figure></p>
<p>安装成功转到6步，执行make命令。<br>9)、zmalloc.h:50:31: 致命错误：jemalloc/jemalloc.h：没有那个文件或目录<br>在make 后面增加 MALLOC=libc<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># make MALLOC=libc</div></pre></td></tr></table></figure></p>
<p>10)、安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># make install</div></pre></td></tr></table></figure></p>
<p>注：在编译时，出现“../deps/geohash-int/geohash.h:78:18: 附注：‘longitude’在此声明” 警告；还有一个变量未定义。不清楚是否会有影响。目前，安装后运行测试都正常。</p>
<p><a href="https://github.com/uglide/RedisDesktopManager/releases/download/0.8.8/redis-desktop-manager-0.8.8.384.exe" target="_blank" rel="external">Redis Desktop Manager</a></p>
<h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><p>1)、启动服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">redis-server redis.conf</div></pre></td></tr></table></figure>
<p> <a href="http://www.cnblogs.com/GoQC/p/5764201.html" target="_blank" rel="external">Redis 安装 启动 连接 配置 重启</a></p>
<p>2)、测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ redis-cli</div><div class="line">127.0.0.1:6379&gt; set foo bar</div><div class="line">OK</div><div class="line">127.0.0.1:6379&gt; get foo</div><div class="line">&quot;bar&quot;</div></pre></td></tr></table></figure>
<p>恭喜你，已经成功安装！</p>
<h3 id="2、分布式配置"><a href="#2、分布式配置" class="headerlink" title="2、分布式配置"></a>2、分布式配置</h3><p>参考[1]:<a href="http://www.redis.cn/topics/cluster-tutorial.html" target="_blank" rel="external">Redis Cluster搭建方法简介</a></p>
<p>参考[2]:<a href="http://blog.csdn.net/weiguolong0306/article/details/51586557" target="_blank" rel="external"> Centos7 搭建Redis3.2.0版本集群环境</a></p>
<p>准备ruby环境,后续redis-trib.rb会用到。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># yum install ruby</div><div class="line"># yum install rubygems</div><div class="line"># gem install redis</div></pre></td></tr></table></figure></p>
<h4 id="搭建并使用Redis集群"><a href="#搭建并使用Redis集群" class="headerlink" title="搭建并使用Redis集群[]"></a>搭建并使用Redis集群[]</h4><p>1、准备redis.conf配置文件<br>redis.conf配置如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">port 7000</div><div class="line">cluster-enabled yes</div><div class="line">cluster-config-file nodes.conf</div><div class="line">cluster-node-timeout 5000</div><div class="line">appendonly yes</div></pre></td></tr></table></figure></p>
<p>2、创建目录后分别启动<br>创建目录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mkdir cluster-test</div><div class="line">cd cluster-test</div><div class="line">mkdir 7000 7001 7002 7003 7004 7005</div></pre></td></tr></table></figure></p>
<p>在文件夹 7000 至 7005 中， 各创建一个 redis.conf 文件,文件中的端口与文件加相同。<br>启动,因文件夹加多启动比较繁琐。可用写个简单的脚本执行,注意一定是在文件夹内执行命令。<br>vi runcluster.sh 将下面内容cp进去。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">cd 7000/</div><div class="line">../redis-server ./redis.conf &amp;</div><div class="line">cd ../7001</div><div class="line">../redis-server ./redis.conf &amp;</div><div class="line">cd ../7002</div><div class="line">../redis-server ./redis.conf &amp;</div><div class="line">cd ../7003</div><div class="line">../redis-server ./redis.conf &amp;</div><div class="line">cd ../7004</div><div class="line">../redis-server ./redis.conf &amp;</div><div class="line">cd ../7005</div><div class="line">../redis-server ./redis.conf &amp;</div></pre></td></tr></table></figure></p>
<p>nohup redis-server ./redis.conf &gt; /cluster-test/log/redis-7000.log 2&gt;&amp;1 &amp;</p>
<p>chomd +X runcluster.sh //添加执行权限<br>然后,./runcluster.sh  运行。这样就全都启动了。</p>
<p>3、搭建集群<br>redis-trib 位于 Redis 源码的 src 文件夹中,你要把它cp到cluster-test目录下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./redis-trib.rb create --replicas 1 127.0.0.1:7000 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005</div></pre></td></tr></table></figure>
<p>注意:在执行时会出现”All nodes agree about slots configuration”提示,不能直接回车,一定输入yes再回车。<br>当出现下面的说明配置完成。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">12400:S 12 Jan 14:45:21.671 * Background AOF rewrite finished successfully</div><div class="line">12397:M 12 Jan 14:45:22.055 # Cluster state changed: ok</div><div class="line">12398:M 12 Jan 14:45:22.155 # Cluster state changed: ok</div><div class="line">12399:M 12 Jan 14:45:22.189 # Cluster state changed: ok</div></pre></td></tr></table></figure></p>
<p>4、检验是否配置成功<br>./redis-trib.rb check :7000<br>你也可用通过客户端连接上测试<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">redis-cli -c -p 7000</div><div class="line">127.0.0.1:7000&gt; cluster nodes</div><div class="line">1577e1769a77367dd4a626b316f4191224f726c6 127.0.0.1:7005 slave 8da8517b0edd30f30104e091d782d40803c0723d 0 1484203764628 6 connected</div><div class="line">7436728328935447bccc1c1b54e6eab372b8c4e1 127.0.0.1:7000 myself,master - 0 0 1 connected 0-5460</div><div class="line">8da8517b0edd30f30104e091d782d40803c0723d 127.0.0.1:7002 master - 0 1484203766133 3 connected 10923-16383</div><div class="line">3a3e3c8407ee19f9f762c3a7496fc0d213ee452d 127.0.0.1:7001 master - 0 1484203765631 2 connected 5461-10922</div><div class="line">48302b26e73b33da61914a33d62865ba0e83f6cb 127.0.0.1:7003 slave 7436728328935447bccc1c1b54e6eab372b8c4e1 0 1484203764127 4 connected</div><div class="line">5b75f1ce4b70e3a780016d3a77daea7adde432ce 127.0.0.1:7004 slave 3a3e3c8407ee19f9f762c3a7496fc0d213ee452d 0 1484203765129 5 connected</div><div class="line">127.0.0.1:7000&gt; cluster info</div><div class="line">cluster_state:ok</div><div class="line">cluster_slots_assigned:16384</div><div class="line">cluster_slots_ok:16384</div><div class="line">cluster_slots_pfail:0</div><div class="line">cluster_slots_fail:0</div><div class="line">cluster_known_nodes:6</div><div class="line">cluster_size:3</div><div class="line">cluster_current_epoch:6</div><div class="line">cluster_my_epoch:1</div><div class="line">cluster_stats_messages_sent:1169</div><div class="line">cluster_stats_messages_received:1169</div><div class="line">127.0.0.1:7000&gt; set name hello</div><div class="line">-&gt; Redirected to slot [5798] located at 127.0.0.1:7001</div><div class="line">OK</div><div class="line"></div><div class="line">redis-cli -c -p 7003</div><div class="line">127.0.0.1:7003&gt; get name</div><div class="line">-&gt; Redirected to slot [5798] located at 127.0.0.1:7001</div><div class="line">&quot;hello&quot;</div></pre></td></tr></table></figure></p>
<p>5、 <a href="http://blog.csdn.net/daiyudong2020/article/details/51674169" target="_blank" rel="external">redis集群设置密码</a><br>注意事项：<br>1.如果是使用redis-trib.rb工具构建集群，集群构建完成前不要配置密码，集群构建完毕再通过config set + config rewrite命令逐个机器设置密码<br>2.如果对集群设置密码，那么requirepass和masterauth都需要设置，否则发生主从切换时，就会遇到授权问题，可以模拟并观察日志<br>3.各个节点的密码都必须一致，否则Redirected就会失败<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">config set masterauth abc</div><div class="line">config set requirepass abc</div><div class="line">config rewrite</div></pre></td></tr></table></figure></p>
<p>config set masterauth “simonzhang”<br>config set requirepass “simonzhang”<br>config rewrite</p>
<p>密码方式访问：</p>
<p>redis-cli -p 7000 -a abc   //abc is password</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#客户端关闭</div><div class="line">redis-cli -h 127.0.0.1 -p 6379 shutdown</div><div class="line">redis-cli -h 127.0.0.1 -p 6380 shutdown</div><div class="line">#启动</div><div class="line">redis-server redis6379.conf &amp;</div><div class="line">redis-server redis6380.conf &amp;</div></pre></td></tr></table></figure>
<p>??? 主从切换<br><a href="http://www.2cto.com/database/201502/377061.html" target="_blank" rel="external"></a></p>
<h3 id="3、搭建前哨sentinel"><a href="#3、搭建前哨sentinel" class="headerlink" title="3、搭建前哨sentinel"></a>3、搭建前哨sentinel</h3><p>配置<br>redis-sentinel ./sentinel001.conf &amp;<br>redis-sentinel ./sentinel002.conf &amp;<br>redis-sentinel ./sentinel003.conf &amp;</p>
<p>注：sentinel.conf中要指定redis服务器的网络ip地址.不能为本机地址（127.0.0.1/localhost）。这是在单机部署时一定要注意的。</p>
<p>在有sentinel的集群环境中报：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">DENIED Redis is running in protected mode because protected mode is enabled, no bind address was specified, no authentication password is requested to clients. In this mode connections are only accepted from the loopback interface. If you want to connect from external computers to Redis you may adopt one of the following solutions:</div><div class="line">1) Just disable protected mode sending the command &apos;CONFIG SET protected-mode no&apos; from the loopback interface by connecting to Redis from the same host the server is running, however MAKE SURE Redis is not publicly accessible from internet if you do so. Use CONFIG REWRITE to make this change permanent.</div><div class="line">2) Alternatively you can just disable the protected mode by editing the Redis configuration file, and setting the protected mode option to &apos;no&apos;, and then restarting the server.</div><div class="line">3) If you started the server manually just for testing, restart it with the &apos;--protected-mode no&apos; option.</div><div class="line">4) Setup a bind address or an authentication password.</div><div class="line"> NOTE: You only need to do one of the above things in order for the server to start accepting connections from the outside.</div></pre></td></tr></table></figure></p>
<h3 id="4、主从配置"><a href="#4、主从配置" class="headerlink" title="4、主从配置"></a>4、主从配置</h3><p>master 部署在192.168.0.99上，配置文件为redis.conf;slave部署在192.168.0.100上，从master上复制一份配置文件命名为redis-slave.conf,如果你是单机部署需要修改ip和端口号。<br>再在redis-slav.conf配置文件中增加：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">slaveof 192.168.0.99 6379</div></pre></td></tr></table></figure></p>
<h3 id="5、配置文件"><a href="#5、配置文件" class="headerlink" title="5、配置文件"></a>5、配置文件</h3><p><a href="http://blog.csdn.net/u012173245/article/details/52041882" target="_blank" rel="external">http://blog.csdn.net/u012173245/article/details/52041882</a><br><a href="http://yijiebuyi.com/blog/bc2b3d3e010bf87ba55267f95ab3aa71.html" target="_blank" rel="external">http://yijiebuyi.com/blog/bc2b3d3e010bf87ba55267f95ab3aa71.html</a><br><a href="https://raw.githubusercontent.com/antirez/redis/3.0/redis.conf" target="_blank" rel="external">https://raw.githubusercontent.com/antirez/redis/3.0/redis.conf</a></p>
<h3 id="6、参考资料"><a href="#6、参考资料" class="headerlink" title="6、参考资料"></a>6、参考资料</h3><p><a href="http://www.cnblogs.com/LiZhiW/p/4851631.html#_label2" target="_blank" rel="external">http://www.cnblogs.com/LiZhiW/p/4851631.html#_label2</a><br><a href="http://blog.csdn.net/donggang1992/article/details/50981341" target="_blank" rel="external">http://blog.csdn.net/donggang1992/article/details/50981341</a><br><a href="http://blog.csdn.net/zyz511919766/article/details/42268219" target="_blank" rel="external">http://blog.csdn.net/zyz511919766/article/details/42268219</a><br><a href="http://www.cnblogs.com/stupidMartian/p/5904030.html" target="_blank" rel="external">http://www.cnblogs.com/stupidMartian/p/5904030.html</a></p>
<h4 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">#修改为守护模式</div><div class="line">daemonize yes</div><div class="line">#设置进程锁文件</div><div class="line">pidfile /usr/local/redis/redis.pid</div><div class="line">#端口</div><div class="line">port 6379</div><div class="line">#客户端超时时间</div><div class="line">timeout 300</div><div class="line">#日志级别</div><div class="line">loglevel debug</div><div class="line">#日志文件位置</div><div class="line">logfile /usr/local/redis/log-redis.log</div><div class="line">#设置数据库的数量，默认数据库为0，可以使用SELECT &lt;dbid&gt;命令在连接上指定数据库id</div><div class="line">databases 8</div><div class="line">##指定在多长时间内，有多少次更新操作，就将数据同步到数据文件，可以多个条件配合</div><div class="line">#save &lt;seconds&gt; &lt;changes&gt;</div><div class="line">#Redis默认配置文件中提供了三个条件：</div><div class="line">save 900 1</div><div class="line">save 300 10</div><div class="line">save 60 10000</div><div class="line">#指定存储至本地数据库时是否压缩数据，默认为yes，Redis采用LZF压缩，如果为了节省CPU时间，</div><div class="line">#可以关闭该#选项，但会导致数据库文件变的巨大</div><div class="line">rdbcompression yes</div><div class="line">#指定本地数据库文件名</div><div class="line">dbfilename dump.rdb</div><div class="line">#指定本地数据库路径</div><div class="line">dir /usr/local/redis/db/</div><div class="line">#指定是否在每次更新操作后进行日志记录，Redis在默认情况下是异步的把数据写入磁盘，如果不开启，可能</div><div class="line">#会在断电时导致一段时间内的数据丢失。因为 redis本身同步数据文件是按上面save条件来同步的，所以有</div><div class="line">#的数据会在一段时间内只存在于内存中</div><div class="line">appendonly no</div><div class="line">#指定更新日志条件，共有3个可选值：</div><div class="line">#no：表示等操作系统进行数据缓存同步到磁盘（快）</div><div class="line">#always：表示每次更新操作后手动调用fsync()将数据写到磁盘（慢，安全）</div><div class="line">#everysec：表示每秒同步一次（折衷，默认值）</div><div class="line">appendfsync everysec</div></pre></td></tr></table></figure>
<h3 id="6、文档"><a href="#6、文档" class="headerlink" title="6、文档"></a>6、文档</h3><ul>
<li><a href="http://doc.redisfans.com/#" target="_blank" rel="external">Redis 命令参考</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://petewell.cn/2017/01/17/01.redis3.2.6_安装及分布式配置/" data-id="cj49mjyap0002vts6vipxs4k1" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/分布式/">分布式</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-03.spring与Jedis整合使用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/17/03.spring与Jedis整合使用/" class="article-date">
  <time datetime="2017-01-17T01:47:57.000Z" itemprop="datePublished">2017-01-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/17/03.spring与Jedis整合使用/">03. spring与jedis整合使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>##03. spring与jedis整合使用</p>
<h3 id="spring-redis"><a href="#spring-redis" class="headerlink" title="spring redis"></a>spring redis</h3><ul>
<li><a href="http://www.cnblogs.com/LiZhiW/p/4853486.html" target="_blank" rel="external">04.spring-data-redis与Jedis整合使用</a></li>
<li><a href="https://github.com/kangyonggan/spring-redis" target="_blank" rel="external">spring整合redis实现无侵入式的缓存管理</a></li>
<li><a href="http://blog.csdn.net/u013725455/article/details/52129283" target="_blank" rel="external">Spring集成Redis使用注解</a></li>
<li><a href="http://phipray.iteye.com/blog/2248352" target="_blank" rel="external">SpringMVC+Shiro+RedisCluster搭建session统一管理</a></li>
<li><a href="https://github.com/alexxiyang/shiro-redis" target="_blank" rel="external">shiro-redis</a></li>
</ul>
<h3 id="ehcache"><a href="#ehcache" class="headerlink" title="ehcache"></a>ehcache</h3><p>*<a href="http://elim.iteye.com/blog/2123030" target="_blank" rel="external">Spring使用Cache、整合Ehcache</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://petewell.cn/2017/01/17/03.spring与Jedis整合使用/" data-id="cj49mjybh0005vts6ma7vl61q" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/分布式/">分布式</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-关于spring-jpa-多表关系查询时，自定义返回对象" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/16/关于spring-jpa-多表关系查询时，自定义返回对象/" class="article-date">
  <time datetime="2017-01-16T07:41:20.000Z" itemprop="datePublished">2017-01-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/16/关于spring-jpa-多表关系查询时，自定义返回对象/">关于spring jpa 多表关系查询时，自定义返回对象</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>比如在获取用户资料时，我们不想把密码等重要信息全部带出。那时，我们就要用到jpa query 返回指定字段。</p>
<p>我要在网上查找了下都是比较基础的单表查询。好了，如何写呢？</p>
<p>例如，下面的我们会将user的所有属性都会带出来，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"> @Query(&quot;SELECT u FROM BaseUser u JOIN u.roles roles WHERE roles.roleCode = :roleCode)</div><div class="line"></div><div class="line"> List&lt;BaseUser&gt; findUserByRoleCode(@Param(&quot;roleCode&quot;) String roleCode);</div><div class="line"></div><div class="line"> ⚠：上面select 后面的 “u” 是一个BaseUser，包括所有的属性。这是我们所不需要的，它泄漏了太多的信息。</div></pre></td></tr></table></figure>
<p> 我们要指定字段，怎么定义呢？前面试了两次都失败了，最后参考<a href="https://my.oschina.net/u/1045177/blog/550173" target="_blank" rel="external">Spring Data Jpa 查询返回自定义对象</a> 才解决，非常感谢。也分享下我的经验。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"> 1、 @Query(&quot;SELECT name,id,org FROM BaseUser u JOIN u.roles roles WHERE roles.roleCode = :roleCode)</div><div class="line"></div><div class="line"> ⚠ 这个根本就不能编译通过。</div><div class="line"></div><div class="line"> 2、 @Query(&quot;SELECT u.name,u.id,u.org  FROM BaseUser u JOIN u.roles roles WHERE roles.roleCode = :roleCode)</div><div class="line"></div><div class="line"> ⚠ 这个可以编译通过 但返回的不是BaseUser对象，只包括name，id属性和 org对象。不符合我的条件。</div><div class="line"></div><div class="line">3、@Query(&quot;SELECT new BaseUser(u.id,u.loginname,u.roles,u.org)  FROM BaseUser u JOIN u.roles roles WHERE roles.roleCode = :roleCode)</div></pre></td></tr></table></figure>
<p>只有这个是正确的，返回了baseUser对象。这个要注意的是必须在实体baseuser中创建相应的构造方法。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://petewell.cn/2017/01/16/关于spring-jpa-多表关系查询时，自定义返回对象/" data-id="cj49mjycl0010vts6o72nw5f8" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring/">Spring</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-sonar-配置服务默认路径问题" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/05/sonar-配置服务默认路径问题/" class="article-date">
  <time datetime="2017-01-05T08:38:48.000Z" itemprop="datePublished">2017-01-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/05/sonar-配置服务默认路径问题/">sonar 配置服务默认路径问题</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>sonar 配置后台服务时，出现“Temp directory is not writable” 问题解决：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">WrapperSimpleApp: Encountered an error running main: java.lang.IllegalStateException: Temp directory is not writable: C:\Windows\system32\config\systemprofile\AppData\Local\Temp\</div><div class="line">java.lang.IllegalStateException: Temp directory is not writable: C:\Windows\system32\config\systemprofile\AppData\Local\Temp\</div><div class="line">at org.sonar.process.MinimumViableSystem.checkWritableDir(MinimumViableSystem.java:60)</div><div class="line">at org.sonar.process.MinimumViableSystem.checkWritableTempDir(MinimumViableSystem.java:52)</div><div class="line">at org.sonar.process.MinimumViableSystem.check(MinimumViableSystem.java:45)</div><div class="line">at org.sonar.application.App.main(App.java:108)</div><div class="line">at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</div><div class="line">at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)</div><div class="line">at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)</div><div class="line">at java.lang.reflect.Method.invoke(Method.java:597)</div><div class="line">at org.tanukisoftware.wrapper.WrapperSimpleApp.run(WrapperSimpleApp.java:240)</div><div class="line">at java.lang.Thread.run(Thread.java:619)</div><div class="line">Caused by: java.io.IOException: 系统找不到指定的路径。</div><div class="line">at java.io.WinNTFileSystem.createFileExclusively(Native Method)</div><div class="line">at java.io.File.checkAndCreate(File.java:1704)</div><div class="line">at java.io.File.createTempFile(File.java:1792)</div><div class="line">at org.sonar.process.MinimumViableSystem.checkWritableDir(MinimumViableSystem.java:57)</div><div class="line">... 9 more</div><div class="line">&amp;lt;-- Wrapper Stopped</div><div class="line">The SonarQube service was launched, but failed to start.</div></pre></td></tr></table></figure>
<p>解决办法如下：</p>
<p>在conf目录找到wrapper.conf文件，打开。<br>在“wrapper.java.additional.1=-Djava.awt.headless=true”下增加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">###set temp dir ,solve Temp directory is not writable</div><div class="line">wrapper.java.additional.2=-Djava.io.tmpdir=../../temp`</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://petewell.cn/2017/01/05/sonar-配置服务默认路径问题/" data-id="cj49mjycc000pvts6jl2uurjn" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/开发工具/">开发工具</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-关于arcgis-server性能优化" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/05/关于arcgis-server性能优化/" class="article-date">
  <time datetime="2017-01-05T08:31:33.000Z" itemprop="datePublished">2017-01-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/05/关于arcgis-server性能优化/">关于arcgis server性能优化</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>arcgis server安装后，池化“最大实例数”默认为2。可在“服务属性”对话框的池化选项卡中设置最大实例数，调整的原则为：首先应将实例数设置为等于 N+1，其中 N 是计算机上 CPU 核的数量。在个别情况下，如果您发现计算机上的 CPU 利用率未接近 90%，则可以考虑添加更多实例。</p>
<p><a href="http://help.arcgis.com/zh-cn/arcgisdesktop/10.0/help/index.html#/na/00530000009r000000/" target="_blank" rel="external">http://help.arcgis.com/zh-cn/arcgisdesktop/10.0/help/index.html#/na/00530000009r000000/</a></p>
<p>其他的部署及参数要求可参考：</p>
<p><a href="http://help.arcgis.com/zh-cn/arcgisdesktop/10.0/help/index.html#/na/000400000006000000/" target="_blank" rel="external">http://help.arcgis.com/zh-cn/arcgisdesktop/10.0/help/index.html#/na/000400000006000000/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://petewell.cn/2017/01/05/关于arcgis-server性能优化/" data-id="cj49mjych000wvts6nrxod3hn" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GIS/">GIS</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-关于各项目临时表空间占用磁盘空间比较大，并且再持续增长的解决方案" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/05/关于各项目临时表空间占用磁盘空间比较大，并且再持续增长的解决方案/" class="article-date">
  <time datetime="2017-01-05T08:29:57.000Z" itemprop="datePublished">2017-01-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/05/关于各项目临时表空间占用磁盘空间比较大，并且再持续增长的解决方案/">关于各项目临时表空间占用磁盘空间比较大，并且再持续增长的解决方案</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="一、临时表空间的作用"><a href="#一、临时表空间的作用" class="headerlink" title="一、临时表空间的作用"></a>一、临时表空间的作用</h3><p>Oracle临时表空间主要用来做查询和存放一些缓冲区数据。临时表空间消耗的主要原因是需要对查询的中间结果进行排序，下面的操作都会<br>使用大量的temporary段 ：<br>索引create或rebuild；<br>Order by 或 group by；<br>Distinct 操作；<br>Union 或 intersect 或 minus；<br>Sort-merge joins；<br>IMP/EXP操作；</p>
<h3 id="二、临时表空间建多大合适，个人建议"><a href="#二、临时表空间建多大合适，个人建议" class="headerlink" title="二、临时表空间建多大合适，个人建议"></a>二、临时表空间建多大合适，个人建议</h3><p>1.一般的业务系统频繁使用临时段的需要单独创建临时表空间<br>2.临时表空间的太大或太小都会影响数据库性能，一般建议根据业务系统一天产生的大小作为初始大小。<br>3.临时表空间需要定期维护</p>
<h3 id="三、oracle11g-临时表空间收缩（只针对oracle11g以后版本）"><a href="#三、oracle11g-临时表空间收缩（只针对oracle11g以后版本）" class="headerlink" title="三、oracle11g 临时表空间收缩（只针对oracle11g以后版本）"></a>三、oracle11g 临时表空间收缩（只针对oracle11g以后版本）</h3><ol>
<li>常用查询临时表空间视图</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">select * from v$datafile //查询数据文件</div><div class="line">select * from v$tablespace //查询表空间信息</div><div class="line">select * from v$tempfile //查询临时文件信息</div><div class="line">select S.tablespace_name,S.TABLESPACE_SIZE/1024/1024 TSIZE,S.ALLOCATED_SPACE/1024/1024 USIZE,S.FREE_SPACE/1024/1024 FFIZE from dba_temp_free_space S //查询临时表空间使用情况</div></pre></td></tr></table></figure>
<ol>
<li>临时表空间收缩</li>
</ol>
<p>收缩临时表空间：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alter tablespace USER_TEMP_TBS shrink space keep 200M;</div></pre></td></tr></table></figure>
<p>收缩临时文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ALTER TABLESPACE USER_TEMP_TBS SHRINK TEMPFILE &apos;/opt/oracle/oradata/user_temp_tbs01.dbf&apos; keep 200M;</div></pre></td></tr></table></figure>
<p>以上操作已经在测试环境中验证过，可以立即收缩空间，对数据库无太大影响，如果是生产库建议晚上做以上操作，否则会出现等待事件。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://petewell.cn/2017/01/05/关于各项目临时表空间占用磁盘空间比较大，并且再持续增长的解决方案/" data-id="cj49mjycn0011vts6i4mx4csy" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据库/">数据库</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/02/hello-world/" class="article-date">
  <time datetime="2017-01-02T02:01:44.000Z" itemprop="datePublished">2017-01-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/02/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://petewell.cn/2017/01/02/hello-world/" data-id="cj49mjybz000ivts6e7b9pzpk" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Jenkins部署到远程（Linux服务器）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/22/Jenkins部署到远程（Linux服务器）/" class="article-date">
  <time datetime="2016-01-22T05:51:22.000Z" itemprop="datePublished">2016-01-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/22/Jenkins部署到远程（Linux服务器）/">Jenkins部署到远程（Linux服务器）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>参考：<a href="http://www.tuicool.com/articles/buEFfi7" target="_blank" rel="external">http://www.tuicool.com/articles/buEFfi7</a></p>
<p>jenkins、ssh实现了远程自动化部署或者发布。一般情况下，我们都会要把项目部署到远程Linux服务器上，所以这节的主要内容是：</p>
<p>1、部署（发布）开发环境下的Web项目到远程Linux服务器；</p>
<p>2、实现自动备份；</p>
<p>当然，发布程序要比部署要简单，不需要执行远程脚步。</p>
<h4 id="准备环境："><a href="#准备环境：" class="headerlink" title="准备环境："></a>准备环境：</h4><p>jenkins环境，Linux服务器，linux安装tomcat。</p>
<h4 id="步骤："><a href="#步骤：" class="headerlink" title="步骤："></a>步骤：</h4><p>1、安装插件，登录到Jenkins后台，选择“系统管理”&#8212;&gt;“管理插件”，在可选插件中，选择 <a href="http://wiki.jenkins-ci.org/display/JENKINS/Publish+Over+SSH+Plugin" target="_blank" rel="external">Publish Over SSH</a> ，安装这个插件；</p>
<p>2、安装完后，配置这个选项，在系统管理中找到，如下图：</p>
<p>如果SSH是通过Key来进行验证的这里需要输入相关服务器的Key，要是通过用户名密码进行验证的话，SSH Key的输入栏可以全部置空。</p>
<p>&nbsp;<br><img src="/images/674c63a970af2ad41c161960683b4034.jpg" alt="Jenkins(Hudson)实现远程部署Web项目 Publish Over SSH Plugin插件"></p>
<p>我是通过用户名和密码进行验证的，因此SSH Server要配置服务器的信息还有用户名和密码。</p>
<p>&nbsp;<br><img src="/images/6E07EA50-6687-423E-9AD1-9436F1B68B07.png" alt="Jenkins(Hudson)实现远程部署Web项目 Publish Over SSH Plugin插件"></p>
<p>这里只说下主要配置项，SSH Server Name，服务器名称，自己随便起个名字即可；Hostname，服务器的IP地址；Username，远程服务器的帐号，这里我用了root；Remote Directory，访问路径，“/”根路径即可。</p>
<p>其他的选项参考， <a href="http://blog.csdn.net/wangmuming/article/details/22925895" target="_blank" rel="external">http://blog.csdn.net/wangmuming/article/details/22925895</a>。</p>
<p>3、这次不用新建项目了，以上次建的项目为基础，做个拷贝，在此基础上修改就行，如图：</p>
<p><img src="/images/22QBfuI.png" alt="Jenkins(Hudson)实现远程部署Web项目"></p>
<p>4、上面的都不用动，只修改“构建后操作”，把上次部署war包的方式（Deploy war/ear to a container）删除，添加刚才安装插件后的（Send build artifacts over SSH），配置见图：</p>
<p><img src="/images/0D8064F6-D0B0-481B-B095-57E49E19A8C6.png" alt="Jenkins(Hudson)实现远程部署Web项目"></p>
<p>需要注意的地方：Remote directory，这个最好配置为绝对路径，主要是为了临时放置项目的地方，在第5步可以看到；如果只是发布程序，exec command 不需要设置；如果部署，需要设置远程deploy.sh 脚本位置。</p>
<p>5、增加deploy.sh脚本，新下载的tomcat的bin目录没有该文件，自己新建一个即可，里面的内容如下，根据自己的实际情况进行调整，都是一些常见的shell命令：</p>
<pre class="prettyprint bash"><span class="shebang">#!/bin/sh</span>
export JAVA_HOME=/usr/java/jdk1.7.0_75
kill -9 $(ps -aef | grep tomcat | grep -v grep | awk <span class="string">'{print $2}'</span>)
cd /app/programs/tomcat_test1/webapps
mv ROOT.war ROOT_`date +%Y%m%d%H%M%S`.war.bak
<span class="comment">#rm -rf ROOT</span>
mv  /app/programs/temp/mvcDemo3*-SNAPSHOT.war ROOT.war
cd /app/programs/tomcat_test1/bin

./startup.sh</pre>

<p>6、经过以上配置后，访问测试，运行通过。</p>
<p>总结：截至到现在，已经完成了自动化部署到本地和远程的全部配置。我这两篇文档主要侧重于操作实现和备忘，一些细节未进行说明，有需要的朋友可以自行往下深入研究，可以一块讨论。。。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://petewell.cn/2016/01/22/Jenkins部署到远程（Linux服务器）/" data-id="cj49mjybo0007vts6wu7h1z0c" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/开发工具/">开发工具</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-在linux-使用exp导出备份数据时提示EXP-00091-Exporting-questionable-statistics" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/05/在linux-使用exp导出备份数据时提示EXP-00091-Exporting-questionable-statistics/" class="article-date">
  <time datetime="2016-01-05T08:40:04.000Z" itemprop="datePublished">2016-01-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/05/在linux-使用exp导出备份数据时提示EXP-00091-Exporting-questionable-statistics/">在linux 使用exp导出备份数据时提示EXP-00091: Exporting questionable statistics.</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在linux 使用exp导出备份数据时提示：<br>EXP-00091: Exporting questionable statistics.<br>1.问题产生的原因<br>linux下oracle用户环境变量语言集和oracle数据库中的环境变量语言集不同<br>2.解决方法<br>只要将oracle环境变量语言集改成和数据库环境变量语言集一样的就可以<br>查看服务端字符集</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select * from nls_database_parameters t where t.parameter=&apos;NLS_CHARACTERSET&apos;</div></pre></td></tr></table></figure>
<p>or</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select * from v$nls_parameters where parameter=&apos;NLS_CHARACTERSET&apos;;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">[oracle@rac01 ~]$ export NLS_LANG=AMERICAN_AMERICA.ZHS16GBK</div><div class="line">[oracle@rac01 ~]$ exp tuser/****** tables=UCM_BOARDWS_INSTALLWORK,UCM_BOARDWS_APINSTALL file=/orabak/1015installworkBak.dmp log=/orabak/1015installworkBak.log</div><div class="line"></div><div class="line">Export: Release 11.2.0.3.0 - Production on Wed Oct 15 10:05:16 2014</div><div class="line"></div><div class="line">Copyright (c) 1982, 2011, Oracle and/or its affiliates. All rights reserved.</div><div class="line">Connected to: Oracle Database 11g Enterprise Edition Release 11.2.0.3.0 - 64bit Production</div><div class="line">With the Partitioning, Real Application Clusters, Automatic Storage Management, OLAP,</div><div class="line">Data Mining and Real Application Tes</div><div class="line">Export done in ZHS16GBK character set and AL16UTF16 NCHAR character set</div><div class="line"></div><div class="line">About to export specified tables via Conventional Path ...</div><div class="line">. . exporting table UCM_BOARDWS_INSTALLWORK 1998871 rows exported</div><div class="line">. . exporting table UCM_BOARDWS_APINSTALL 2190269 rows exported</div><div class="line">Export terminated successfully without warnings.</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://petewell.cn/2016/01/05/在linux-使用exp导出备份数据时提示EXP-00091-Exporting-questionable-statistics/" data-id="cj49mjycq0014vts6aih6a8tg" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据库/">数据库</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/GIS/">GIS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring/">Spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hibernate-ORM/">hibernate ORM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql-数据库/">mysql 数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oracle-数据库/">oracle 数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/quartz/">quartz</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分布式/">分布式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分布式-zookeeper/">分布式 zookeeper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/工具/">工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/工具-java安装/">工具 java安装</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/开发工具/">开发工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据库/">数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/生活/">生活</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/GIS/" style="font-size: 10px;">GIS</a> <a href="/tags/Spring/" style="font-size: 10px;">Spring</a> <a href="/tags/hibernate-ORM/" style="font-size: 10px;">hibernate ORM</a> <a href="/tags/mysql-数据库/" style="font-size: 10px;">mysql 数据库</a> <a href="/tags/oracle-数据库/" style="font-size: 10px;">oracle 数据库</a> <a href="/tags/quartz/" style="font-size: 10px;">quartz</a> <a href="/tags/redis/" style="font-size: 10px;">redis</a> <a href="/tags/分布式/" style="font-size: 16.67px;">分布式</a> <a href="/tags/分布式-zookeeper/" style="font-size: 10px;">分布式 zookeeper</a> <a href="/tags/工具/" style="font-size: 10px;">工具</a> <a href="/tags/工具-java安装/" style="font-size: 10px;">工具 java安装</a> <a href="/tags/开发工具/" style="font-size: 20px;">开发工具</a> <a href="/tags/数据库/" style="font-size: 13.33px;">数据库</a> <a href="/tags/生活/" style="font-size: 10px;">生活</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">一月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">八月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">七月 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/06/23/sublime_text3_快捷键/">sublime text3 快捷键</a>
          </li>
        
          <li>
            <a href="/2017/06/23/mysql访问权限设置/">Host &#39;192.168.＊.＊&#39; is not allowed to connect to this MariaDB server</a>
          </li>
        
          <li>
            <a href="/2017/05/27/关于hibernate_could_not_resolve_property_provinceid_of_错误/">关于hibernate could not resolve property_ provinceId of 错误</a>
          </li>
        
          <li>
            <a href="/2017/05/17/quartz_cronexpression表达式/">quartz CronExpression表达式</a>
          </li>
        
          <li>
            <a href="/2017/05/12/zookeeper 安装和配置/">zookeeper 安装和配置</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 simon zhang<br>
      Powered by <a href="http://petewell.cn" target="_blank">petewell</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/category" class="mobile-nav-link">分类</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
    <a href="/about" class="mobile-nav-link">关于</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>